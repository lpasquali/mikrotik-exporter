version: 2
jobs:
  build:
    environment:
      SHORT_GIT_HASH: $(git rev-parse --short HEAD)
      
    docker:
      - image: cimg/go:1.18.10
    branches:
      only:
        - trunk
        - /^nshttpd.*/
    steps:
      - checkout
      - setup_remote_docker:
          version: 18.06.0-ce
      - run: env PATH=$PATH:$GOPATH/bin make dockerhub
